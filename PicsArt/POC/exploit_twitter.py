
import sys
import urllib
import urllib2
from twython import Twython
import json
import traceback

APP_KEY=''
APP_SECRET=''
OAUTH_TOKEN=''
OAUTH_TOKEN_SECRET=''

def obtain_key(twitter_id):
	url = 'https://api.picsart.com/users/signin.json'
	only_twitter_id = '''{"id":"%s","token_secret":"","profile_url":"","screen_name":"","token":"","name":""}''' %twitter_id
	data = 'token=&auth='+ urllib.quote(only_twitter_id)+'&provider=twitter'
	req = urllib2.Request(url, data)
	response = urllib2.urlopen(req)
	jsonobject = json.loads(response.read())
	return jsonobject['key']

def obtain_twitter_token(key):
	url = '''https://api.picsart.com/connections/show/me.json?key=%s''' %key
	response = urllib2.urlopen(url)
	data = json.loads(response.read())
	print data
	global OAUTH_TOKEN  
	OAUTH_TOKEN = data['response'][0]['token']
	global OAUTH_TOKEN_SECRET  
	OAUTH_TOKEN_SECRET = data['response'][0]['data']['token_secret']

def post_on_twitter():
	twitter = Twython(APP_KEY, APP_SECRET,OAUTH_TOKEN, OAUTH_TOKEN_SECRET)
	print twitter.verify_credentials()
	twitter.update_status(status='Using twitter!')

if __name__ == '__main__':
	if len(sys.argv) < 1: 
		print "No Twitter ID specified"
		exit(0)	
	userKey =obtain_key(sys.argv[1])
	print "User key for accessing user's Picsart account is %s" %userKey
	try:
		obtain_twitter_token(userKey)	
		post_on_twitter()
	except:
		traceback.print_exc()
		print "Failed accessing user's Twitter account"
		pass
