import facebook
import sys
import sys
import urllib
import urllib2
import json
import traceback
#using github.com/pythonforfacebook/facebook-sdk
OAUTH_TOKEN = ''

def obtain_key(facebook_id):
	url = 'https://api.picsart.com/users/signin.json'
	only_facebook_id = '''{"id":"%s","cover":"","username":"","profile_url":"","email":"","name":""}''' %facebook_id
	data = 'token=&auth='+ urllib.quote(only_facebook_id)+'&provider=facebook'
	req = urllib2.Request(url, data)
	response = urllib2.urlopen(req)
	jsonobject = json.loads(response.read())
	return jsonobject['key']


def obtain_facebook_token(key):
	url = '''https://api.picsart.com/connections/show/me.json?key=%s''' %key
	response = urllib2.urlopen(url)
	data = json.loads(response.read())
	print data
	global OAUTH_TOKEN  
	OAUTH_TOKEN = data['response'][0]['token']
	
def post_on_facebook():
	graph = facebook.GraphAPI(OAUTH_TOKEN)
	profile = graph.get_object("me")
	friends = graph.get_connections("me", "friends")
	graph.put_object("me", "feed", message="I am writing on their wall!")

if __name__ == '__main__':
	if len(sys.argv) < 1: 
		print "No facebook ID specified"
		exit(0)	
	userKey =obtain_key(sys.argv[1])
	print "User key for accessing user's Picsart account is %s" %userKey
	try:
		obtain_facebook_token(userKey)
		print "Facebook access token is %s" % OAUTH_TOKEN
		post_on_facebook()
	except:
		traceback.print_exc()
		print "Failed accessing user's Facebook account, perhaps user hasn't given the app permission to post"
		pass
	