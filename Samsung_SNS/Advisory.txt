Fundación Dr. Manuel Sadosky - Programa STIC Advisory
www.fundacionsadosky.org.ar

Vulnerabilidades en la aplicación Samsung SNS de Android


1. *Información del reporte*

Título: Vulnerabilidades en la aplicación Samsung SNS de Android
Reporte ID: STIC-2014-0511
Reporte URL: http://www.fundacionsadosky.org.ar/publicaciones-2
Fecha de publicación: 2015-2-23
Fecha de última actualización: 2014-3-10
Fabricantes contactados: Samsung
Modo de publicación: Coordinado


2. *Información de vulnerabilidades*

Clase:  Incorrecta asignación de permiso para recurso crítico [CWE-732]
Impacto: Perdida de datos
Remotamente explotable: Si
Localmente explotable: Si
Identificador CVE: N/A


3. *Descripción de vulnerabilidad*

      La aplicación Samsung Social Networking Service (o SNS) es utilizada para manejar las cuentas sociales de un usuario y actua como un servicio para que otras aplicaciones de Samsung, como Calendar y Gallery3D, puedan obtener información de las redes sociales del usuario. Esta aplicación viene instalada en varios dispositivos Samsung. Por ejemplo, en el proyecto de Android Census  [2] identificó un subconjunto de dispositivos en los cuales esta aplicación viene instalada. De acuerdo a [4], la aplicación de Facebook relacionada a esta app tiene entre 41 millones de usuarios activos mensuales, 17 millones de usuarios activos semanales y 5 millones de usuarios activos diarios.
    
    Cuando un usuario se logea en Facebook o Twitter, la aplicación SNS inmediatamente requiere al usuario que permita a la aplicación de Facebook (o Twitter) "Samsung Galaxy" acceso completo a la cuenta. Si el usuario acepta el acceso, la aplicación se guarda el token de acceso en un archivo Shared Preference para que pueda ser utilizada luego cuando se realicen pedidos de información desde otras aplicaciones a esa red social. En nuevos dispositivos (corriendo Android 4.4 o mayor), la aplicación de SNS permite también conectarse a las redes Google+, LinkedIn y Foursquare.
    
    La aplicación de SNS tiene múltiples servicios exportados utilizados para el manejo y la sincronización de las redes sociales del usuario (Facebook, Twitter o Foursquare y Google+ en dispositivos más nuevos). Estos servicios no están protegidos por ningún permiso. Esto permitiría a aplicaciones maliciosas que utilicen estos servicios desprotegidos para directamente para obtener directamente fotos, estados, noticias, ubicación y información de otro tipo de las cuentas de Facebok o Twitter del usuario así como postear nuevo contenido.
    
    Otros servicios exportados permiten a una nueva aplicación requerir los tokens de acceso que permiten a uno adquirir a información de las cuentas de Twitter y de Facebook. Estos servicios se encuentran protegidos por permisos que no incluyen el tag "protectionLevel" adecuado. Debido a esto, los permisos son tratado como "normal" así que cualquier aplicación puede requerirlos y a los usuarios no se le notifica por defecto cuando ocurre. Aún más, los permisos no poseen etiquetas o descripciones adecuadas que le permitiesen a un usuario entender que se le está requiriendo cuando fuesen pedidos por una aplicación maliciosa. Luego, aplicaciones maliciosas que pidan estos permisos se podrían conectar a estos servicios para obtener las credenciales (tokens de acceso) que le permitirían acceso permanente a la información de la red social del usuario. Por ejemplo, a partir del token de acceso de Facebook otorgado a la aplicación de SNS se puede acceder a los mensajes privados del usuario.
    
    En dispositivos más viejos (Android 4.3 o menor), los permisos que protegen a los content provider son también declarados como "normal" así que cualquier aplicación que acceda al dispositivo puede pedir acceso a estos content providers y leer cualquier información almacenada en ellos. 
    

4. *Paquetes vulnerables*

   . Aplicación de Samsung SNS con versiones anteriores a 1.1.1 en 4.1
   . Aplicación de Samsung SNS con versiones anteriores a 1.1.6 en 4.2
   . Aplicación de Samsung SNS con versiones anteriores a 1.2.1 en 4.3
   . Aplicación de Samsung SNS con versiones anteriores a 1.3.5 en 4.4
   . Aplicación de Samsung SNS con versiones anteriores a 1.3.5 en 5.0

5. *Información y soluciones del fabricante*
  
    Samsung deshabilitó las apps de Twitter y Facebook llamadas "Samsung Galaxy". Esto automáticamente protege a los usuarios de malware que accediese a los access tokens almacenados o que abuse los servicios exportados pero no de que información almacenada sea exfiltrada a través de los content providers.
    Se recomienda a los usuarios que actualicen a la última versión de SNS en el mercado Galaxy Apps [1] y que remuevan el acceso de la aplicación "Samsung Galaxy" en sus redes sociales o  deshabiliten la aplicación SNS y borrar sus datos almacenados. Debido a la deshabilitación de las apps de Facebook y Twitter, notificaciones de la forma "Try Single Sign On again" o "Facebook Session Expired Error Message" son exhibidas en dispositivos corriendo las versiones vulnerables de SNS.
    

6. *Créditos*

Las vulnerabilidades fueron descubiertas e investigadas por Joaquín Manuel Rinaudo. La publicación de este reporte fue coordinada por Programa de Seguridad en TIC. 

7. *Descripción técnica*

    Todas las versiones de SNS tienen dos servicios exportados por los cuales aplicaciones pueden acceder información o interactuar con las redes sociales de Facebook y Twitter, llamados 'SnsFbService' and 'SnsTwService'. Estos servicios permiten a una aplicación el acceso a información del usuario (como fotos, estados, eventos, likes, etc en Facebook o obtener el token de acceso con el servicio relacionado a Twitter) e incluso postear contenido en nombre del usuario. Un tercer servicio exportado 'SnsFbServiceForAuthToken' permite a a una aplicación acceder a la credencial usada para acceder a la cuenta de Facebook (el token de acceso) pero es protegida con un permiso custom: 'com.sec.android.app.sns3.permission.SNS_FB_ACCESS_TOKEN'. En dispositivos cuya versión es mayor a Android 4.1, ocurre lo mismo con Twitter, el servicio protegido 'SnsTwServiceForAuthToken' y el permiso  'com.sec.android.app.sns3.permission.SNS_TW_ACCESS_TOKEN'. Estos permisos custom tienen nivel de protección normal así que otras aplicaciones pueden pedirlos.
  
    Para conectarse a estos servicios, un atacante necesitaría saber su interfaz. Los archivos AIDL de estos servicios podrían ser reconstruidos a partir de ingeniería reversa de la aplicación. Las interfaces para el servicio relacionado con Twitter se encuentra en 'com.sec.android.app.sns3.svc.sp.twitter.api' y el de Facebook en  'com.sec.android.app.sns3.svc.sp.facebook.auth.api'. 
    
    Una prueba de concepto de la vulnerabilidad puede encontrarse en [3]. El apk compilado se encuentra también en el mismo sitio. La aplicación requiere los permisos custom de Samsung para comunicarse con los servicios protegidos de SNS de Facebook y Twitter. Sólo cuando se muestran todos los permisos, un usuario puede ver los permisos extra denominados Default cuya descripción son "string resource". La aplicación se conecta exitosamente con ambos servicios exportados de SNS sobre Facebook (el protegido por un permiso y el que no) junto con uno de los servicios protegidos de Twitter. Cuando se hace click en el primer botón, la aplicación obtiene el token de acceso de Twitter del usuario (si a la aplicación se le dió uno) utilizando un método exportado vía AIDL del servicio 'SnsTwServiceForAuthToken'. Este método funciona en dispositivos corriendo versiones mayores a 1.1.1 de SNS. Haciendo click en el segundo botón, la aplicación hace lo mismo con Facebook utilizando el servicio 'SnsFbServiceForAuthToken'. Finalmente, cuando se hace click en el último botón, se llama a unos de los métodos del servicio desprotegido 'SnsFbService' para postear una publicación en el muro del usuario con el texto "Hackers o dominados", para esta acción no es necesaria ningún permiso.   
    
    En nuevos dispositivos (corriendo Android 4.4 o más) LinkedIn, Google+ y Foursquare también se pueden conectar a SNS. Los últimos dos tienen también servicios desprotegidos pero exportados llamados  'SnsGpService' y 'SnsFsService' respectivamente. Sus interfaces pueden encontrase en 'com.sec.android.app.sns3.svc.sp.googleplus.api' y 'com.sec.android.app.sns3.svc.sp.foursquare.api'. Sin embargo la API de Google+ sólo permite acceso a contenido público [6] y los componentes de Foursquare que permiten a la aplicación SNS manejar la cuenta del usuario se encuentran deshabilitados. 
  
    En versiones anteriores (Android 4.3 o menor) la información guardada en los ContentProviders podría ser exfiltrada por una aplicación maliciosa que requiera el permiso 'com.sec.android.app.sns3.permission.READ_SNS_DB'[5] y luego haga una consulta a la base donde se encuentran almacenadas las noticias y fotos de la red social Facebook. Atacantes además podrían actualizar la información contenida en estos proveedores enviando una señal de broadcast tanto a 'SnsFbWidgetUpdatePhotoStreamReceiver' como a 'SnsFbTickerUpdateFeedsReceiver'.
  

8. *Cronología del reporte*

. 2014-11-20:
Programa de Seguridad en TIC notificó al equipo de seguridad móvil del fabricante de haber descubierto una vulnerabilidad en una aplicación pre-instalada en múltiples dispositivos móviles y pidió una clave del equipo para continuar la comunicación por un canal encriptado para coordinar la publicación del reporte.
        

. 2014-11-21:
 
          El equipo de seguridad móvil de Samsung envía su clave para tener un canal de comunicación encriptado.
        

. 2014-11-25:
Programa de Seguridad en TIC envió un reporte preliminar acerca de los problemas de seguridad en la aplicación de Samsung SNS y notificó de una fecha estimada de publicación del reporte de Diciembre 2, 2014. 
        

. 2014-11-26:

          El equipo de seguridad móvil de Samsung pidió de retrasar el reporte y pidió de una exploit prueba de concepto. 
        

. 2014-11-26:
Programa de Seguridad en TIC informó al fabricante que la fecha de publicación era establecida en caso que el reporte no fuese reconocido o no hubiese un plan para arreglar el problema. Dado que el fabricante reconoció el reporte, el reporte sería pospuesto a Diciembre 16, 2014. Además, Programa de Seguridad en TIC incluyó un APK prueba de concepto abusando los servicios exportados de la aplicación SNS de Samsung.
        

. 2014-11-29:

         El equipo de seguridad móvil de Samsung confirmó el problema de seguridad y acordó contactarse de vuelta la semana que viene para determinar la fecha de divulgación.
        

. 2014-12-02:
Programa de Seguridad en TIC preguntó por los modelos de dispositivos y versiones de software vulnerables para proveer a su base de usuarios con información precisa y mantuvo la publicación del reporte para el 16 de Diciembre. 
        

. 2014-12-12:

         El equipo de seguridad móvil de Samung comentó que una actualización requeriría coordinación entre Samsung, redes sociales y proveedores de red y pidió informar a las redes sociales para resolver el problema de forma adecuada y debido a esto pidió postergar la divulgación hasta la fecha de publicación de la actualización que estimaban que sería dentro de 6 meses desde la fecha. Se informó que tardarían en obtener información de los dispositivos y versiones de software vulnerables.
        

. 2014-15-15:

          El equipo de seguridad móvil de Samung pidió confirmar el mail previo acerca de la fecha de divulgación de la vulnerabilidad.
        

. 2014-12-15:
Programa de Seguridad en TIC reconoció haber recibido el mail y acepto posponer la divulgación pero informó al fabricante que los 6 meses pedidos era demasiado tiempo. Una nueva fecha sería discutida internamente con el grupo junto con soluciones alternativas.
        

. 2014-1-2:

           El equipo de seguridad móvil de Samung concluyó que una actualización tardaría más de 6 meses debido a complejidades en el ecosistema de Android y problemas en actualizar software en algunos modelos debido a políticas de la prestadora. 
        

. 2014-1-9:
 reconoció que las complicaciones para proveer un patch a aplicaciones instaladas de Samsung. Además propuso soluciones alternativas como informar a los usuarios que deshabilitaran la app SNS desde sus cuentas de Facebook o que Samsung invalide directamente el APP ID de Facebook correspondiente a esa aplicación. 
        

. 2014-1-26:
 
        El equipo de seguridad móvil de Samsung informó haber hablado con Facebook y Twitter para solucionar el problema y pidió permiso para enviarles información acerca de la institución a ellos, además sugirió que tomaría otro mes aproximadamente para preparar la invalidación del App ID debido a sus procesos de QA.
        

. 2014-1-27:
Programa de Seguridad en TIC acordó informar a Facebook y Twitter acerca de su identidad y información de contacto y además solicitó un estimado preciso de la solución para posponer la divulgación.
        

. 2014-2-4:

          El equipo de seguridad móvil de Samung informó que la mejor protección para proteger sus usuarios sería deshabilitar el APP ID utilizado desde el lado del servidor de las redes sociales (Facebook y Twitter), dado que esta acción instantáneamente protegería a sus usuarios pero notificó que los resultados de esta acción estaban siendo testeados.
        

. 2014-2-11:
Programa de Seguridad en TIC preguntó por el estado y si las apps de las redes sociales serían invalidadas el 13 de Febrero.
        

. 2014-2-11:

          El equipo de seguridad móvil de Samung notificó que estaban esperando a que el equipo de QA termine el testing.
        

. 2014-2-13:

          El equipo de seguridad móvil de Samung espera terminar el testing para Febrero 17 y invalidar los apps una vez que el testing concluyese exitosamente.
        

. 2014-2-14:
Programa de Seguridad en TIC reprograma la publicación para Febrero 19 y hizo un pedido de la declaración oficial para incluir en el reporte.
        

. 2014-2-16:

          El equipo de seguridad móvil de Samung solicitó retrasar la publicación a Marzo 10, 2015 dado a las celebraciones de año nuevo durante el 18~22 de Febrero y la necesidad de monitorear la experiencia de los usuarios por una semana y permitir al sector de Relaciones Públicas preparar una declaración para incluir en el reporte.
        

. 2014-2-26:

          Equipo de seguridad móvil de Samsung informó que una actualización fue publicada el 17 de Febrero y que el app ID antiguo de Twitter había sido deshabilitado. Además, el 20 de Febrero se restringió la API de Facebook para sincronización. Además pidió por un borrador del reporte. 
        

. 2014-3-3:
 envió el reporte y además confirmó las mitigaciones para los app IDs anteriores de Facebook y Twitter. Dado que el contenido descargado todavía sería accesible utilizando el content provider, se le recomendaría a los usuarios actualizar la aplicación o eliminar los datos y deshabilitarla. Además, se preguntó a Samsung si se habían implementado arreglos para los servicios de Google+ y Foursquare de SNS en nuevos dispositivos.
        

. 2014-3-3:

          Equipo de seguridad móvil de Samsung aseguró que los componentes de Foursquare estaban deshabilitados en todas las versiones y que ahora los componentes de Google+ y Foursquare eran protegidos por permisos de "signatureOrSystem". Además dado que la API de Google+ tenía restricciones para sólo poder acceder a contenido público, versiones anteriores no obtendrían información privada desde el servicio exportado. Aunque la actividad de LinkedIn era lanzada, SNS o tiene la capacidad para agregar esa cuenta y o almacena ninguno de esos datos. 
        


9. *Referencias*

[1] http://www.samsung.com/levant/support/skp/faq/1072595
[2] http://census.tsyrklevich.net/content_providers/com.sec.android.app.sns3.sp.facebook
[3] https://LINK TO SOURCE CODE
[4] http://www.factets.com/application/samsung-galaxy-dfNWi8eIS
[5] http://census.tsyrklevich.net/permissions/com.sec.android.app.sns3.permission.READ_SNS_DB
[6] https://developers.google.com/+/api/

10. *Acerca Fundación Dr. Manuel Sadosky*

La Fundación Dr. Manuel Sadosky es una institución público privada cuyo objetivo es favorecer la articulación entre el sistema científico – tecnológico y la estructura productiva en todo lo referido a la temática de las Tecnologías de la Información y la Comunicación (TIC). Creada a través del Decreto Nro. 678/09 del Poder Ejecutivo Nacional, la Fundación es presidida por el ministro de Ciencia, Tecnología e Innovación Productiva. Sus vicepresidentes son los presidentes de las cámaras más importantes del sector TIC: CESSI (Cámara de Empresas de Software y Servicios Informáticos) y CICOMRA (Cámara de Informática y Comunicaciones de la República Argentina). Para más información visitar: http://www.fundacionsadosky.org.ar

11. *Derechos de autor*

El contenido de este reporte tiene copyright (c) 2014 Fundación Sadosky y se publica bajo la licencia Creative Commons Attribution Non-Commercial Share-Alike 4.0: http://creativecommons.org/licenses/by-nc-sa/4.0/